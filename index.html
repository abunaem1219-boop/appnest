<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Neon App Hub - v2.4 (Play Button Fixed)</title>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;700&display=swap" rel="stylesheet">

    <style>
        /* --- GLOBAL CSS WITH VARIABLES --- */
        :root {
            --bg-body: #0e0e0e;
            --text-main: #ffffff;
            --text-secondary: #cccccc;
            --glass-bg: rgba(20, 20, 30, 0.85);
            --glass-border: rgba(255, 255, 255, 0.15);
            --accent-primary: #9f00ff; /* Purple */
            --accent-secondary: #00ffff; /* Cyan */
            --gradient-text: linear-gradient(90deg, #ff00ff, var(--accent-primary), var(--accent-secondary));
            --skeleton-base: #1a1a1a;
            --skeleton-highlight: #333333;
            --nav-height: 60px;
            --verified-color: #00b0ff;
        }

        [data-theme="light"] {
            --bg-body: #f4f4f9;
            --text-main: #1a1a1a;
            --text-secondary: #555555;
            --glass-bg: rgba(255, 255, 255, 0.9);
            --glass-border: rgba(0, 0, 0, 0.1);
            --accent-primary: #6200ea;
            --accent-secondary: #00b0ff;
            --gradient-text: linear-gradient(90deg, #6200ea, #00b0ff);
            --skeleton-base: #e0e0e0;
            --skeleton-highlight: #f5f5f5;
        }

        /* Neon Color Themes */
        [data-neon="blue"] { --accent-primary: #0066ff; --accent-secondary: #00ccff; }
        [data-neon="yellow"] { --accent-primary: #ffcc00; --accent-secondary: #ffff00; }
        [data-neon="red"] { --accent-primary: #ff0000; --accent-secondary: #ff4444; }
        [data-neon="pink"] { --accent-primary: #ff00cc; --accent-secondary: #ff66ff; }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Poppins', sans-serif; }

        body {
            background-color: var(--bg-body);
            background-image: 
                radial-gradient(circle at top left, rgba(var(--accent-primary), 0.15), transparent 40%),
                radial-gradient(circle at bottom right, rgba(var(--accent-secondary), 0.15), transparent 40%);
            background-attachment: fixed;
            color: var(--text-main);
            min-height: 100vh;
            overflow-x: hidden;
            transition: background-color 0.3s ease, color 0.3s ease;
            padding-bottom: var(--nav-height); 
        }

        h1, h2, h3 {
            background: var(--gradient-text);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            color: var(--accent-primary);
        }

        /* Elements */
        .glass-panel {
            background: var(--glass-bg);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border-radius: 25px;
            border: 1px solid var(--glass-border);
            padding: 2rem;
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.3);
            margin-bottom: 20px;
        }

        .btn {
            padding: 10px 25px;
            border-radius: 50px;
            cursor: pointer;
            font-weight: 700;
            border: none;
            transition: 0.3s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            text-decoration: none;
        }
        .btn:hover { transform: scale(1.05); }

        .btn-solid {
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            color: white;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }
        
        .btn-outline {
            background: transparent;
            color: var(--accent-secondary);
            border: 2px solid var(--accent-secondary);
        }
        .btn-outline.active {
            background: var(--accent-secondary);
            color: var(--bg-body);
        }
        .btn-danger {
            background: #ff4444;
            color: white;
            padding: 5px 15px;
            font-size: 0.8rem;
        }
        .btn-logout {
            background: transparent;
            border: 1px solid #ff4444;
            color: #ff4444;
            padding: 8px 20px;
        }
        .btn-login {
            background: var(--accent-primary);
            color: white;
            padding: 8px 20px;
            border: none;
        }

        input, textarea, select {
            width: 100%;
            padding: 12px;
            background: rgba(128, 128, 128, 0.1);
            border: 1px solid var(--glass-border);
            border-radius: 15px;
            color: var(--text-main);
            margin-bottom: 15px;
            outline: none;
        }
        input:focus, textarea:focus { border-color: var(--accent-secondary); box-shadow: 0 0 8px var(--accent-secondary); }

        /* HEADER */
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 5%;
            position: sticky;
            top: 0;
            z-index: 100;
            background: var(--glass-bg);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--glass-border);
        }

        .filters { display: flex; gap: 10px; }
        .search-bar { width: 200px; margin-bottom: 0; }
        @media(max-width: 600px) { .filters { display: none; } }

        /* GRID */
        .content-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 30px;
            padding: 40px 5%;
            min-height: 50vh; 
        }

        .app-card {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            transition: 0.3s;
            position: relative;
        }
        .app-card:hover { transform: translateY(-5px); }
        .app-logo {
            width: 80px; height: 80px;
            border-radius: 20px;
            object-fit: cover;
            margin-bottom: 15px;
            border: 2px solid var(--glass-border);
            background: #000;
        }
        .app-title { font-size: 1.2rem; margin-bottom: 5px; color: var(--text-main); font-weight: 700;}
        .app-type { font-size: 0.8rem; color: var(--accent-secondary); margin-bottom: 15px; text-transform: uppercase; letter-spacing: 1px;}
        .blue-tick { color: var(--verified-color); margin-left: 4px; display: inline-block; width: 14px; height: 14px; }
        
        /* SIDE MENU */
        #side-menu {
            position: fixed;
            top: 0; left: -300px;
            width: 300px;
            height: 100vh;
            background: var(--bg-body);
            border-right: 1px solid var(--accent-primary);
            transition: 0.4s ease;
            z-index: 1000;
            padding: 40px 20px;
            display: flex;
            flex-direction: column;
            gap: 20px;
            overflow-y: auto;
        }
        #side-menu.open { left: 0; }
        .close-menu { position: absolute; top: 15px; right: 20px; font-size: 1.5rem; cursor: pointer; color: var(--text-main); }
        .menu-link {
            color: var(--text-main); font-size: 1.2rem; text-decoration: none; padding: 10px;
            border-radius: 10px; transition: 0.2s;
        }
        .menu-link:hover { background: rgba(255,255,255,0.1); color: var(--accent-secondary); }
        .admin-link { color: #ff4444 !important; border: 1px solid #ff4444; }

        /* MODALS */
        #themeModal, #detailsModal, #playModal, #commentsModalWrapper, #authModal {
            position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
            background: rgba(0,0,0,0.8); backdrop-filter: blur(5px);
            z-index: 5000;
            display: none; align-items: center; justify-content: center;
        }
        #playModal { background: black; z-index: 9999; }
        
        .theme-content, .details-content {
            width: 90%; max-width: 450px;
            position: relative; text-align: center;
            display: flex; flex-direction: column; align-items: center;
        }
        
        /* AUTH MODAL STYLES */
        .auth-content {
            width: 90%; max-width: 400px;
            position: relative;
            display: flex; flex-direction: column; align-items: center;
            animation: popIn 0.3s ease;
        }
        @keyframes popIn { from { transform: scale(0.9); opacity: 0; } to { transform: scale(1); opacity: 1; } }

        .auth-toggle-text {
            margin-top: 15px; font-size: 0.9rem; color: var(--text-secondary); cursor: pointer; text-decoration: underline;
        }
        .auth-toggle-text:hover { color: var(--accent-secondary); }

        .back-btn, .close-details {
            position: absolute; top: 20px; left: 20px; font-size: 1.2rem;
            cursor: pointer; color: var(--text-main); background: none; border: none;
            display: flex; align-items: center; gap: 5px;
        }
        .close-details { left: auto; right: 20px; font-size: 2rem; top: 10px; }
        
        /* DETAILS ACTION BAR */
        .action-bar {
            display: flex; justify-content: space-around; width: 100%; margin: 20px 0;
            padding-top: 20px; border-top: 1px solid var(--glass-border);
        }
        .action-btn {
            display: flex; flex-direction: column; align-items: center; gap: 5px;
            background: none; border: none; color: var(--text-secondary); cursor: pointer;
        }
        .action-btn i { font-size: 1.5rem; transition: 0.3s; }
        .action-btn:hover i, .action-btn.active i { color: var(--accent-primary); transform: scale(1.2); }
        .stat-count { font-size: 0.8rem; }
        
        /* PROFILE STYLES */
        .profile-banner {
            width: 100%; height: 120px; background-size: cover; background-position: center;
            border-radius: 20px 20px 0 0; background-color: #333;
        }
        .profile-header {
            display: flex; flex-direction: column; align-items: center; margin-top: -50px;
        }
        .profile-avatar {
            width: 100px; height: 100px; border-radius: 50%; border: 4px solid var(--bg-body);
            background: #222; object-fit: cover;
        }
        .profile-stats {
            display: flex; gap: 20px; margin: 15px 0; font-size: 0.9rem; color: var(--text-secondary);
        }
        .social-links { display: flex; gap: 15px; margin-bottom: 20px; }
        .social-icon { font-size: 1.5rem; color: var(--text-main); text-decoration: none; }
        .social-icon:hover { color: var(--accent-secondary); }
        .my-uploads-list { display: flex; flex-direction: column; gap: 10px; width: 100%; }
        .upload-item-row {
            display: flex; justify-content: space-between; align-items: center;
            background: rgba(255,255,255,0.05); padding: 10px; border-radius: 10px;
        }
        .status-tag { padding: 2px 8px; border-radius: 4px; font-size: 0.7rem; text-transform: uppercase; }
        .st-approved { background: rgba(0, 255, 0, 0.2); color: #00ff00; }
        .st-pending { background: rgba(255, 165, 0, 0.2); color: orange; }
        
        /* HIDDEN FORM WRAPPER */
        #editProfileWrapper { display: none; margin-top: 20px; }

        /* ADMIN PANEL */
        .admin-user-row {
            display: flex; justify-content: space-between; align-items: center;
            background: rgba(255,255,255,0.05); padding: 10px; margin-bottom: 10px; border-radius: 10px;
        }
        .verify-btn { padding: 5px 10px; font-size: 0.8rem; cursor: pointer; border:none; border-radius:5px; }
        .v-active { background: var(--accent-secondary); color: black; }
        .v-inactive { background: gray; color: white; }

        /* COMMENTS */
        .comments-content {
            width: 100%; max-width: 600px; height: 60vh;
            background: var(--bg-body);
            border-top-left-radius: 25px; border-top-right-radius: 25px;
            border: 1px solid var(--glass-border);
            display: flex; flex-direction: column;
            animation: slideUp 0.3s ease-out;
            box-shadow: 0 -5px 20px rgba(0,0,0,0.5);
        }
        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
        
        .comments-header {
            padding: 15px; border-bottom: 1px solid var(--glass-border);
            display: flex; justify-content: space-between; align-items: center;
        }
        .comments-list {
            flex: 1; overflow-y: auto; padding: 15px;
            display: flex; flex-direction: column; gap: 15px;
        }
        .comment-item {
            background: rgba(255,255,255,0.05); padding: 10px; border-radius: 10px;
            display: flex; flex-direction: column; gap: 5px;
        }
        .c-user { font-weight: bold; color: var(--accent-secondary); font-size: 0.9rem; }
        .c-text { font-size: 0.95rem; line-height: 1.4; }
        .c-actions { display: flex; gap: 15px; margin-top: 5px; }
        .c-act-btn { 
            background: none; border: none; color: var(--text-secondary); cursor: pointer; font-size: 0.8rem;
            display: flex; align-items: center; gap: 3px;
        }
        .c-act-btn:hover { color: var(--text-main); }
        .comments-input-area {
            padding: 15px; border-top: 1px solid var(--glass-border);
            display: flex; gap: 10px; background: var(--glass-bg);
        }
        .comments-input-area input { margin-bottom: 0; }

        /* PAGE SECTIONS */
        .page-section {
            display: none; padding: 40px 5%; max-width: 800px; margin: 0 auto;
            opacity: 0; transition: opacity 0.3s ease-in-out;
        }
        .page-section.active { opacity: 1; }
        #homeSection { max-width: 100%; }

        /* THEME & SKELETON */
        .theme-options { display: flex; flex-direction: column; gap: 15px; margin-top: 30px; width: 100%; }
        .theme-btn { padding: 15px; background: rgba(255,255,255,0.05); border: 1px solid var(--glass-border); color: var(--text-main); border-radius: 15px; cursor: pointer; transition: 0.3s; }
        .theme-btn:hover, .theme-btn.selected { border-color: var(--accent-primary); background: rgba(var(--accent-primary), 0.1); }
        #neonSubOptions { display: none; margin-top: 20px; width: 100%; }
        .color-swatches { display: flex; justify-content: center; gap: 15px; }
        .swatch { width: 40px; height: 40px; border-radius: 50%; cursor: pointer; border: 2px solid transparent; }
        .swatch:hover, .swatch.active { transform: scale(1.2); border-color: white; }
        .sw-blue { background: #0066ff; } .sw-yellow { background: #ffcc00; } .sw-red { background: #ff0000; } .sw-pink { background: #ff00cc; }
        
        .skeleton {
            background: linear-gradient(90deg, var(--skeleton-base) 25%, var(--skeleton-highlight) 50%, var(--skeleton-base) 75%);
            background-size: 200% 100%; animation: shimmer 1.5s infinite; border-radius: 10px;
        }
        @keyframes shimmer { 0% { background-position: -200% 0; } 100% { background-position: 200% 0; } }
        .sk-logo { width: 80px; height: 80px; border-radius: 20px; margin-bottom: 15px; }
        .sk-title { width: 60%; height: 20px; margin-bottom: 10px; }

        /* NOTIFICATIONS & NAV */
        .notif-bell { position: relative; cursor: pointer; margin-right: 20px; color: var(--text-main); }
        .notif-badge { position: absolute; top: -5px; right: -5px; background: var(--accent-primary); width: 10px; height: 10px; border-radius: 50%; display: none; }
        
        .bottom-nav {
            display: none; position: fixed; bottom: 0; left: 0; width: 100%; height: var(--nav-height);
            background: var(--glass-bg); backdrop-filter: blur(20px); border-top: 1px solid var(--glass-border);
            z-index: 900; justify-content: space-around; align-items: center; padding: 0 10px;
        }
        .nav-item { display: flex; flex-direction: column; align-items: center; color: var(--text-secondary); font-size: 0.75rem; cursor: pointer; transition: 0.3s; }
        .nav-icon { font-size: 1.2rem; margin-bottom: 2px; }
        .nav-item.active { color: var(--accent-secondary); transform: translateY(-2px); }
        @media (max-width: 768px) { .bottom-nav { display: flex; } }

        /* IFRAME */
        #playFrame { width: 100%; height: 100%; border: none; }
        .close-play {
            position: absolute; top: 20px; right: 20px; background: rgba(255, 0, 0, 0.7); color: white;
            width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center;
            justify-content: center; font-size: 1.5rem; cursor: pointer; z-index: 10000; border: 2px solid white;
        }

        /* NEW STYLES FOR GOOGLE SIGN-IN */
        .google-btn {
            background: white;
            color: #757575;
            border: 1px solid #ddd;
            border-radius: 50px;
            padding: 12px 25px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            width: 100%;
            margin-top: 10px;
        }
        
        .google-btn:hover {
            background: #f8f8f8;
            transform: scale(1.02);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .google-btn img {
            width: 20px;
            height: 20px;
        }
        
        .auth-divider {
            display: flex;
            align-items: center;
            width: 100%;
            margin: 20px 0;
        }
        
        .auth-divider::before,
        .auth-divider::after {
            content: "";
            flex: 1;
            height: 1px;
            background: var(--glass-border);
        }
        
        .auth-divider span {
            padding: 0 15px;
            color: var(--text-secondary);
            font-size: 0.9rem;
        }
    </style>
</head>
<body>

    <!-- Header (No Menu Icon) -->
    <header>
        <div style="display:flex; align-items:center;">
            <h2 style="margin-left: 0;">NeonHub</h2>
        </div>
        <div class="filters">
            <button class="btn btn-outline active" onclick="filterItems('All', this)">All</button>
            <button class="btn btn-outline" onclick="filterItems('Game', this)">Games</button>
            <button class="btn btn-outline" onclick="filterItems('App', this)">Apps</button>
        </div>
        <div style="display:flex; align-items:center;">
            <div class="notif-bell" onclick="checkNotifications()">
                &#128276; <span class="notif-badge" id="notifBadge"></span>
            </div>
            <input type="text" class="search-bar" id="searchBar" placeholder="Search...">
        </div>
    </header>

    <!-- Side Menu -->
    <div id="side-menu">
        <span class="close-menu" onclick="toggleMenu()">&times;</span>
        <h2>Menu</h2>
        
        <!-- Profile Mini View -->
        <div id="menu-profile-preview" style="text-align:center; padding:10px; border-bottom:1px solid #333; margin-bottom:10px; display:none;">
            <img id="menu-avatar" src="" style="width:50px; height:50px; border-radius:50%; object-fit:cover;">
            <div id="menu-username" style="font-weight:bold; color:var(--accent-secondary);">User</div>
        </div>

        <a href="#" class="menu-link" onclick="showSection('home'); toggleMenu();">Home</a>
        <a href="#" class="menu-link" onclick="filterItems('Favorites', null); toggleMenu();">&#9733; Favorites</a>
        <a href="#" class="menu-link" onclick="filterItems('Recent', null); toggleMenu();">&#128337; Recently Played</a>

        <a href="#" class="menu-link" onclick="showSection('profile'); toggleMenu();">User Profile</a>
        <a href="#" class="menu-link" onclick="showSection('upload'); toggleMenu();">Upload App/Game</a>
        <a href="#" class="menu-link" onclick="openThemeModal()">Theme Settings</a>

        <!-- Admin Link -->
        <a href="#" class="menu-link admin-link" id="adminLink" style="display:none;" onclick="showSection('admin'); toggleMenu();">Admin Panel</a>
    </div>

    <!-- MOBILE BOTTOM NAVIGATION -->
    <nav class="bottom-nav">
        <div class="nav-item active" id="nav-home" onclick="showSection('home')">
            <span class="nav-icon">&#127968;</span> Home
        </div>
        <div class="nav-item" id="nav-upload" onclick="showSection('upload')">
            <span class="nav-icon">&#8682;</span> Upload
        </div>
        <div class="nav-item" id="nav-profile" onclick="showSection('profile')">
            <span class="nav-icon">&#128100;</span> Profile
        </div>
        <div class="nav-item" onclick="toggleMenu()">
            <span class="nav-icon">&#9776;</span> Menu
        </div>
    </nav>

    <!-- THEME SETTINGS MODAL -->
    <div id="themeModal">
        <div class="glass-panel theme-content">
            <button class="back-btn" onclick="closeThemeModal()">&#8592; Back</button>
            <h2>Appearance</h2>
            <div class="theme-options">
                <div class="theme-btn" onclick="setTheme('dark')" id="btnDark">Dark Mode</div>
                <div class="theme-btn" onclick="setTheme('light')" id="btnLight">Light Mode</div>
                <div class="theme-btn" onclick="setTheme('neon')" id="btnNeon">Neon Mode</div>
            </div>
            <div id="neonSubOptions">
                <p>Select Neon Accent</p>
                <div class="color-swatches">
                    <div class="swatch sw-blue" onclick="setNeonColor('blue')"></div>
                    <div class="swatch sw-yellow" onclick="setNeonColor('yellow')"></div>
                    <div class="swatch sw-red" onclick="setNeonColor('red')"></div>
                    <div class="swatch sw-pink" onclick="setNeonColor('pink')"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- AUTHENTICATION MODAL - UPDATED WITH GOOGLE SIGN-IN -->
    <div id="authModal">
        <div class="glass-panel auth-content">
            <span class="close-details" onclick="closeAuthModal()">&times;</span>
            
            <!-- Login Form -->
            <div id="loginFormView" style="width:100%;">
                <h2>Login</h2>
                
                <!-- Google Sign-In Button -->
                <button type="button" class="google-btn" onclick="handleGoogleSignIn()">
                    <img src="https://upload.wikimedia.org/wikipedia/commons/5/53/Google_%22G%22_Logo.svg" alt="Google Logo">
                    Continue with Google
                </button>
                
                <div class="auth-divider">
                    <span>or continue with email</span>
                </div>
                
                <form onsubmit="handleLogin(event)">
                    <label>Email</label>
                    <input type="email" id="loginEmail" required placeholder="Enter your email">
                    <label>Password</label>
                    <input type="password" id="loginPass" required placeholder="Enter password">
                    <button type="submit" class="btn btn-login" style="width:100%; margin-top:10px;">Login</button>
                </form>
                <p class="auth-toggle-text" onclick="showRegisterForm()">Don't have an account? Create one.</p>
            </div>

            <!-- Register Form -->
            <div id="registerFormView" style="width:100%; display:none;">
                <h2>Create Account</h2>
                
                <!-- Google Sign-In Button -->
                <button type="button" class="google-btn" onclick="handleGoogleSignIn()">
                    <img src="https://upload.wikimedia.org/wikipedia/commons/5/53/Google_%22G%22_Logo.svg" alt="Google Logo">
                    Sign up with Google
                </button>
                
                <div class="auth-divider">
                    <span>or sign up with email</span>
                </div>
                
                <form onsubmit="handleRegister(event)">
                    <label>Display Name</label>
                    <input type="text" id="regName" required placeholder="Your Name">
                    <label>Email</label>
                    <input type="email" id="regEmail" required placeholder="Your Email">
                    <label>Password</label>
                    <input type="password" id="regPass" required placeholder="Create Password">
                    <button type="submit" class="btn btn-login" style="width:100%; margin-top:10px;">Create Account</button>
                </form>
                <p class="auth-toggle-text" onclick="showLoginForm()">Already have an account? Login.</p>
            </div>
        </div>
    </div>

    <!-- GAME DETAILS MODAL -->
    <div id="detailsModal">
        <div class="glass-panel details-content">
            <span class="close-details" onclick="closeDetails()">&times;</span>
            <img id="dm-logo" src="" class="app-logo" style="width:100px; height:100px; margin:0 auto;">
            <h2 id="dm-title" style="margin-top:10px;">Title</h2>
            <!-- Author with Badge -->
            <p id="dm-author" style="color:var(--text-secondary); margin-bottom:15px; font-size:0.9rem;">Author</p>
            
            <div style="margin-bottom:20px; color:var(--text-main); line-height:1.5; max-height: 100px; overflow-y:auto;" id="dm-desc">
                Loading description...
            </div>
            
            <button id="dm-start-btn" class="btn btn-solid" style="padding: 15px 40px; font-size:1.1rem; width:100%;">
                START NOW
            </button>

            <!-- ACTION BAR -->
            <div class="action-bar">
                <button class="action-btn" id="btn-like" onclick="toggleLike()">
                    <span>&#10084;</span> 
                    <span class="stat-count" id="count-like">0</span>
                </button>
                <button class="action-btn" id="btn-fav" onclick="toggleFavorite()">
                    <span id="icon-fav">&#9733;</span>
                    <span class="stat-count">Fav</span>
                </button>
                <button class="action-btn" onclick="openComments()">
                    <span>&#128172;</span>
                    <span class="stat-count" id="count-comment">0</span>
                </button>
            </div>
        </div>
    </div>

    <!-- COMMENTS MODAL -->
    <div id="commentsModalWrapper">
        <div class="comments-content" onclick="event.stopPropagation()">
            <div class="comments-header">
                <h3>Comments</h3>
                <span style="font-size:1.5rem; cursor:pointer;" onclick="closeComments()">&times;</span>
            </div>
            <div class="comments-list" id="commentsList">
                <p style="text-align:center; color:gray;">Loading comments...</p>
            </div>
            <form class="comments-input-area" id="commentForm">
                <input type="text" id="commentInput" placeholder="Write a comment..." required>
                <button type="submit" class="btn btn-solid" style="padding:0 20px;">&#10148;</button>
            </form>
        </div>
    </div>

    <!-- MAIN VIEW (Home) -->
    <div id="homeSection" class="content-grid page-section active" style="opacity: 1;"></div>

    <!-- PROFILE SECTION -->
    <div id="profileSection" class="page-section">
        <div class="glass-panel" style="padding:0;">
            <div class="profile-banner" id="p-banner" style="background-color:#333;"></div>
            <div style="padding: 2rem; position:relative;">
                <div class="profile-header">
                    <img id="p-avatar" src="https://via.placeholder.com/100" class="profile-avatar">
                    <h2 id="p-name" style="margin-top:10px;">User Name</h2>
                    <p id="p-bio" style="font-size:0.9rem; color:var(--text-secondary); max-width:80%; text-align:center;">No bio set.</p>
                </div>
                
                <div style="display:flex; justify-content:center;">
                    <div class="profile-stats">
                        <span>Since: <b id="p-since">-</b></span>
                        <span>Approved: <b id="p-total">-</b></span>
                    </div>
                </div>

                <div class="social-links" style="justify-content:center;">
                    <a href="#" id="sl-fb" class="social-icon" target="_blank" style="display:none;">Facebook</a>
                    <a href="#" id="sl-yt" class="social-icon" target="_blank" style="display:none;">YouTube</a>
                    <a href="#" id="sl-wa" class="social-icon" target="_blank" style="display:none;">WhatsApp</a>
                    <a href="#" id="sl-tt" class="social-icon" target="_blank" style="display:none;">TikTok</a>
                </div>

                <!-- BUTTONS -->
                <div style="display:flex; justify-content:center; gap:10px; margin-top:20px; flex-wrap:wrap;">
                    <button class="btn btn-outline" onclick="toggleEditProfile()" id="btnEditProfile" style="display:none;">Edit Profile</button>
                    <button class="btn btn-login" onclick="openAuthModal()" id="btnLogin">Login</button>
                    <button class="btn btn-logout" onclick="logout()" id="btnLogout" style="display:none;">Logout</button>
                </div>
            </div>
        </div>

        <!-- Edit Profile Form -->
        <div id="editProfileWrapper" class="glass-panel">
            <h3>Edit Profile</h3>
            <form id="profileForm">
                <label>Display Name</label>
                <input type="text" id="profName" required>
                <label>Email Address</label>
                <input type="email" id="profEmail" required readonly style="opacity:0.6;">
                <p style="font-size:0.7rem; color:gray; margin-top:-10px; margin-bottom:10px;">Email cannot be changed.</p>
                <label>Avatar URL (Image Link)</label>
                <input type="url" id="profAvatar" placeholder="https://...">
                <label>Cover Banner URL (Image Link)</label>
                <input type="url" id="profBanner" placeholder="https://...">
                <label>Bio / About Me</label>
                <textarea id="profBio" rows="3" placeholder="Tell us about yourself..."></textarea>
                <h4>Social Links</h4>
                <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
                    <input type="url" id="profFb" placeholder="Facebook URL">
                    <input type="url" id="profYt" placeholder="YouTube URL">
                    <input type="url" id="profWa" placeholder="WhatsApp Link">
                    <input type="url" id="profTt" placeholder="TikTok URL">
                </div>
                <button type="submit" class="btn btn-solid" style="width:100%; margin-top:10px;">Save Profile</button>
            </form>
        </div>

        <div class="glass-panel">
            <h3>My Uploads</h3>
            <div id="myUploadsList" class="my-uploads-list">
                <p>Loading your apps...</p>
            </div>
        </div>
    </div>

    <!-- UPLOAD SECTION -->
    <div id="uploadSection" class="page-section">
        <div class="glass-panel">
            <h1>Upload Submission</h1>
            <form id="uploadForm">
                <label>HTML Code (CSS/JS included)</label>
                <textarea id="upCode" rows="8" placeholder="<html>...</html>" required></textarea>
                <label>Title</label>
                <input type="text" id="upTitle" required>
                <label>Description</label>
                <textarea id="upDesc" rows="3" placeholder="Describe your game/app..." required></textarea>
                <label>Logo URL (Image Link)</label>
                <input type="url" id="upLogo" required>
                <label>Type</label>
                <select id="upType">
                    <option value="Game">Game</option>
                    <option value="App">App</option>
                </select>
                <button type="submit" class="btn btn-solid">Submit for Review</button>
            </form>
        </div>
    </div>

    <!-- ADMIN SECTION -->
    <div id="adminSection" class="page-section">
        <div class="glass-panel">
            <h1>Admin Panel</h1>
            <p>Manage Users & Verification</p>
            <div id="adminUserList" style="margin-top:20px;">
                <p>Loading users...</p>
            </div>
        </div>
    </div>

    <!-- PLAY MODAL -->
    <div id="playModal">
        <div class="close-play" onclick="closePlay()">&times;</div>
        <iframe id="playFrame" sandbox="allow-scripts allow-same-origin"></iframe>
    </div>

    <!-- FIREBASE SDKs -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <!-- Firebase Auth for Google Sign-In -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>

    <script>
        // --- FIREBASE CONFIG ---
        const firebaseConfig = {
          apiKey: "AIzaSyAz77JJfcYnJYZAiIAvGyTRMjyxBSqpfvk",
          authDomain: "neon-app-hube.firebaseapp.com",
          databaseURL: "https://neon-app-hube-default-rtdb.firebaseio.com",
          projectId: "neon-app-hube",
          storageBucket: "neon-app-hube.firebasestorage.app",
          messagingSenderId: "537207065596",
          appId: "1:537207065596:web:e05b23e747e678dbbfc079"
        };

        const app = firebase.initializeApp(firebaseConfig);
        const db = app.database();
        const auth = app.auth();

        const ADMIN_EMAIL = "abunaem1219@gmail.com";
        let allItems = [];
        let currentFilter = 'All';
        let currentItemId = null;
        let currentUser = null; 
        
        function sanitizeEmail(email) {
            return email.replace(/[.#$[\]]/g, "_");
        }

        // Initialize Skeletons Immediately
        showSkeletons();

        window.addEventListener('load', () => {
            const storedUser = JSON.parse(localStorage.getItem('neonUser'));
            
            if(storedUser) {
                // Refresh data from DB to get verified status
                fetchFullUserProfile(storedUser.email).then(userData => {
                    if(userData) {
                        currentUser = userData;
                        localStorage.setItem('neonUser', JSON.stringify(currentUser)); // Update local storage
                    } else {
                        currentUser = storedUser;
                    }
                    updateProfileUI();
                    checkAdmin();
                });
            } else {
                updateProfileUI(); 
            }

            showSection('home');
            setTheme('dark');
            listenForNotifications();
        });

        // --- GOOGLE SIGN-IN FUNCTION ---
        window.handleGoogleSignIn = function() {
            const provider = new firebase.auth.GoogleAuthProvider();
            
            auth.signInWithPopup(provider)
                .then((result) => {
                    // This gives you a Google Access Token
                    const credential = result.credential;
                    const token = credential.accessToken;
                    
                    // The signed-in user info
                    const user = result.user;
                    
                    // Check if user exists in database
                    const key = sanitizeEmail(user.email);
                    
                    db.ref('users/' + key).once('value', snap => {
                        if(snap.exists()) {
                            // User exists, log them in
                            const existingUser = snap.val();
                            alert("Login Successful with Google!");
                            currentUser = existingUser;
                            localStorage.setItem('neonUser', JSON.stringify(currentUser));
                            closeAuthModal();
                            updateProfileUI();
                            window.location.reload();
                        } else {
                            // New user, create account
                            const newUser = {
                                name: user.displayName || user.email.split('@')[0],
                                email: user.email,
                                avatar: user.photoURL || '',
                                memberSince: new Date().toLocaleDateString(),
                                isVerified: false,
                                // No password stored for Google users
                                googleUser: true
                            };
                            
                            db.ref('users/' + key).set(newUser).then(() => {
                                alert("Account Created with Google!");
                                currentUser = newUser;
                                localStorage.setItem('neonUser', JSON.stringify(currentUser));
                                closeAuthModal();
                                updateProfileUI();
                                window.location.reload();
                            });
                        }
                    });
                })
                .catch((error) => {
                    console.error("Google Sign-In Error:", error);
                    alert("Google Sign-In failed: " + error.message);
                });
        };

        // --- GLOBAL FUNCTIONS FOR ONCLICK ---
        window.openAuthModal = function() {
            document.getElementById('authModal').style.display = 'flex';
            showLoginForm();
        }
        window.closeAuthModal = function() {
            document.getElementById('authModal').style.display = 'none';
        }
        window.showLoginForm = function() {
            document.getElementById('loginFormView').style.display = 'block';
            document.getElementById('registerFormView').style.display = 'none';
        }
        window.showRegisterForm = function() {
            document.getElementById('loginFormView').style.display = 'none';
            document.getElementById('registerFormView').style.display = 'block';
        }

        window.handleRegister = function(e) {
            e.preventDefault();
            const name = document.getElementById('regName').value;
            const email = document.getElementById('regEmail').value.trim();
            const pass = document.getElementById('regPass').value;

            if(!email || !pass) return alert("All fields required.");

            const key = sanitizeEmail(email);
            db.ref('users/' + key).once('value', snap => {
                if(snap.exists()) {
                    alert("User already exists! Please login.");
                    showLoginForm();
                } else {
                    const newUser = {
                        name: name,
                        email: email,
                        password: pass,
                        memberSince: new Date().toLocaleDateString(),
                        isVerified: false,
                        googleUser: false
                    };
                    db.ref('users/' + key).set(newUser).then(() => {
                        alert("Account Created! You are now logged in.");
                        currentUser = newUser;
                        localStorage.setItem('neonUser', JSON.stringify(currentUser));
                        closeAuthModal();
                        updateProfileUI();
                        window.location.reload();
                    });
                }
            });
        }

        window.handleLogin = function(e) {
            e.preventDefault();
            const email = document.getElementById('loginEmail').value.trim();
            const pass = document.getElementById('loginPass').value;
            
            const key = sanitizeEmail(email);
            db.ref('users/' + key).once('value', snap => {
                const user = snap.val();
                if(!user) {
                    alert("User not found. Please create an account.");
                } else {
                    // Check if this is a Google user trying to login with password
                    if(user.googleUser) {
                        alert("This account was created with Google. Please use Google Sign-In.");
                        return;
                    }
                    
                    if(user.password && user.password !== pass) {
                        alert("Incorrect Password!");
                    } else {
                        alert("Login Successful!");
                        currentUser = user;
                        localStorage.setItem('neonUser', JSON.stringify(currentUser));
                        closeAuthModal();
                        updateProfileUI();
                        window.location.reload();
                    }
                }
            });
        }

        window.logout = function() {
            if(confirm("Are you sure you want to logout?")) {
                // If user was logged in with Google, sign out from Firebase too
                if(currentUser && currentUser.googleUser) {
                    auth.signOut().then(() => {
                        console.log("Google user signed out");
                    });
                }
                
                localStorage.removeItem('neonUser');
                currentUser = null;
                window.location.reload();
            }
        }

        function fetchFullUserProfile(email) {
            return db.ref('users/' + sanitizeEmail(email)).once('value').then(snap => snap.val());
        }

        function updateProfileUI() {
            // Guest State
            if(!currentUser) {
                document.getElementById('p-name').innerText = "Guest User";
                document.getElementById('p-bio').innerText = "Please login to view your profile details.";
                document.getElementById('p-avatar').src = "https://via.placeholder.com/100";
                
                document.getElementById('btnLogin').style.display = 'inline-block';
                document.getElementById('btnLogout').style.display = 'none';
                document.getElementById('btnEditProfile').style.display = 'none';
                
                document.getElementById('menu-profile-preview').style.display = 'none';
                document.getElementById('myUploadsList').innerHTML = '<p style="text-align:center;">Please login to see uploads.</p>';
                return;
            }
            
            // Logged In State
            document.getElementById('btnLogin').style.display = 'none';
            document.getElementById('btnLogout').style.display = 'inline-block';
            document.getElementById('btnEditProfile').style.display = 'inline-block';

            // Check Verification Tick
            const verifiedTick = currentUser.isVerified ? ' <span class="blue-tick">&#10004;</span>' : '';

            // Sidebar Preview
            document.getElementById('menu-profile-preview').style.display = 'block';
            document.getElementById('menu-avatar').src = currentUser.avatar || 'https://via.placeholder.com/50';
            document.getElementById('menu-username').innerHTML = currentUser.name + verifiedTick;

            // Profile Section
            document.getElementById('p-name').innerHTML = currentUser.name + verifiedTick;
            document.getElementById('p-avatar').src = currentUser.avatar || 'https://via.placeholder.com/100';
            document.getElementById('p-banner').style.backgroundImage = `url('${currentUser.cover || ''}')`;
            document.getElementById('p-bio').innerText = currentUser.bio || "No bio available.";
            document.getElementById('p-since').innerText = currentUser.memberSince || "N/A";

            db.ref('items').orderByChild('userEmail').equalTo(currentUser.email).once('value', s => {
                document.getElementById('p-total').innerText = s.numChildren();
            });

            const s = currentUser.socials || {};
            const setSoc = (id, url, txt) => {
                const el = document.getElementById(id);
                if(url) { el.href = url; el.innerText = txt; el.style.display = 'block'; }
                else el.style.display = 'none';
            };
            setSoc('sl-fb', s.fb, 'Facebook');
            setSoc('sl-yt', s.yt, 'YouTube');
            setSoc('sl-wa', s.wa, 'WhatsApp');
            setSoc('sl-tt', s.tt, 'TikTok');

            // Form Pre-fill
            document.getElementById('profName').value = currentUser.name;
            document.getElementById('profEmail').value = currentUser.email;
            document.getElementById('profAvatar').value = currentUser.avatar || '';
            document.getElementById('profBanner').value = currentUser.cover || '';
            document.getElementById('profBio').value = currentUser.bio || '';
            if(s.fb) document.getElementById('profFb').value = s.fb;
            if(s.yt) document.getElementById('profYt').value = s.yt;
            if(s.wa) document.getElementById('profWa').value = s.wa;
            if(s.tt) document.getElementById('profTt').value = s.tt;

            loadMyUploads();
        }

        window.toggleEditProfile = function() {
            if(!currentUser) return openAuthModal();
            const wrapper = document.getElementById('editProfileWrapper');
            wrapper.style.display = (wrapper.style.display === 'none' || wrapper.style.display === '') ? 'block' : 'none';
            if(wrapper.style.display === 'block') wrapper.scrollIntoView({ behavior: 'smooth' });
        }

        document.getElementById('profileForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const email = document.getElementById('profEmail').value.trim();
            
            const updatedData = {
                name: document.getElementById('profName').value,
                email: email,
                avatar: document.getElementById('profAvatar').value,
                cover: document.getElementById('profBanner').value,
                bio: document.getElementById('profBio').value,
                socials: {
                    fb: document.getElementById('profFb').value,
                    yt: document.getElementById('profYt').value,
                    wa: document.getElementById('profWa').value,
                    tt: document.getElementById('profTt').value
                },
                memberSince: currentUser?.memberSince,
                isVerified: currentUser?.isVerified,
                password: currentUser?.password,
                googleUser: currentUser?.googleUser || false
            };

            const key = sanitizeEmail(email);
            db.ref('users/' + key).update(updatedData).then(() => {
                alert('Profile Saved!');
                currentUser = updatedData;
                localStorage.setItem('neonUser', JSON.stringify(currentUser));
                updateProfileUI();
                document.getElementById('editProfileWrapper').style.display = 'none';
                window.scrollTo(0,0);
            });
        });

        function checkAdmin() {
            if(currentUser && currentUser.email === ADMIN_EMAIL) {
                document.getElementById('adminLink').style.display = 'block';
            }
        }

        window.toggleMenu = function() { document.getElementById('side-menu').classList.toggle('open'); }

        window.showSection = function(sec) {
            const sections = ['home', 'profile', 'upload', 'admin'];
            
            sections.forEach(s => {
                const el = document.getElementById(s + 'Section');
                if(el) { el.classList.remove('active'); el.style.display = 'none'; }
            });

            const targetEl = document.getElementById(sec + 'Section');
            if(targetEl) {
                targetEl.style.display = (sec === 'home') ? 'grid' : 'block';
                setTimeout(() => { targetEl.classList.add('active'); targetEl.style.opacity = '1'; }, 50);
            }

            document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
            const navEl = document.getElementById('nav-' + sec);
            if(navEl) navEl.classList.add('active');

            if(sec === 'home') {
                 if(currentFilter !== 'Favorites' && currentFilter !== 'Recent') {
                    if(allItems.length > 0) renderItems(allItems); 
                 }
            }
            if(sec === 'admin') loadAdminPanel();
        }

        function showSkeletons() {
            const home = document.getElementById('homeSection');
            if(!home) return;
            home.innerHTML = '';
            for(let i=0; i<6; i++) {
                home.innerHTML += `<div class="glass-panel app-card"><div class="skeleton sk-logo"></div><div class="skeleton sk-title"></div></div>`;
            }
        }

        db.ref('items').on('value', (snapshot) => {
            allItems = [];
            const data = snapshot.val();
            if(data) {
                Object.keys(data).forEach(key => allItems.push({ id: key, ...data[key] }));
            }
            
            if(currentFilter === 'Favorites' || currentFilter === 'Recent') {
                filterItems(currentFilter, null);
            } else {
                renderItems(allItems);
            }
        });

        function renderItems(items) {
            const home = document.getElementById('homeSection');
            home.innerHTML = ''; 
            if(items.length === 0) {
                home.innerHTML = '<p style="grid-column:1/-1; text-align:center;">No items found.</p>';
                return;
            }
            items.forEach(item => {
                const card = document.createElement('div');
                card.className = 'glass-panel app-card';
                // Safe ID for inline onclick
                const safeId = item.id; 
                card.innerHTML = `
                    <img src="${item.logo}" class="app-logo" onerror="this.src='https://via.placeholder.com/80?text=Icon'">
                    <div class="app-title">${item.title}</div>
                    <div class="app-type">${item.type}</div>
                    <button class="btn btn-solid" onclick="playItem('${safeId}')">PLAY</button>
                `;
                home.appendChild(card);
            });
        }

        window.filterItems = function(type, btn) {
            currentFilter = type;
            document.querySelectorAll('.filters .btn').forEach(b => b.classList.remove('active'));
            if(btn) btn.classList.add('active');
            
            showSection('home');

            if (type === 'Favorites') {
                const favs = JSON.parse(localStorage.getItem('neonFavorites')) || [];
                const filtered = allItems.filter(item => favs.includes(item.id));
                renderItems(filtered);
            } else if (type === 'Recent') {
                const recents = JSON.parse(localStorage.getItem('neonRecent')) || [];
                const filtered = recents.map(id => allItems.find(i => i.id === id)).filter(Boolean);
                renderItems(filtered);
            } else {
                const query = document.getElementById('searchBar').value.toLowerCase();
                const filtered = allItems.filter(item => {
                    const matchesType = currentFilter === 'All' || item.type === currentFilter;
                    const matchesSearch = item.title.toLowerCase().includes(query);
                    return matchesType && matchesSearch;
                });
                renderItems(filtered);
            }
        };

        document.getElementById('searchBar').addEventListener('input', () => filterItems(currentFilter));

        // --- PLAY ITEM & VERIFICATION CHECK ---
        // Attached to window to ensure visibility
        window.playItem = function(id) {
            console.log("Play clicked:", id);
            currentItemId = id;
            const item = allItems.find(i => i.id === id);
            if(!item) return;

            document.getElementById('dm-logo').src = item.logo;
            document.getElementById('dm-title').innerText = item.title;
            document.getElementById('dm-desc').innerText = item.description || "No description provided.";
            document.getElementById('dm-start-btn').onclick = function() { launchGame(id); };

            // Author Logic with Safety Check
            let authorName = item.userName || "Unknown";
            document.getElementById('dm-author').innerHTML = "Created by: " + authorName;

            // Only verify if email exists to avoid crash
            if (item.userEmail) {
                const userKey = sanitizeEmail(item.userEmail);
                db.ref('users/' + userKey).once('value').then(snap => {
                    const u = snap.val();
                    if(u && u.isVerified) {
                         document.getElementById('dm-author').innerHTML = "Created by: " + authorName + ' <span class="blue-tick">&#10004;</span>';
                    }
                });
            }
            
            updateEngagementUI(id);
            document.getElementById('detailsModal').style.display = 'flex';
        };

        function updateEngagementUI(id) {
            const favs = JSON.parse(localStorage.getItem('neonFavorites')) || [];
            const favBtn = document.getElementById('btn-fav');
            const favIcon = document.getElementById('icon-fav');
            
            if(favs.includes(id)) {
                favBtn.classList.add('active');
                favIcon.style.color = "var(--accent-primary)";
            } else {
                favBtn.classList.remove('active');
                favIcon.style.color = "var(--text-secondary)";
            }

            db.ref(`social/${id}/likes`).on('value', s => {
                document.getElementById('count-like').innerText = s.val() || 0;
            });
            
            if(localStorage.getItem(`liked_${id}`)) document.getElementById('btn-like').classList.add('active');
            else document.getElementById('btn-like').classList.remove('active');

            db.ref(`social/${id}/comments`).on('value', s => {
                document.getElementById('count-comment').innerText = s.numChildren();
            });
        }

        window.toggleFavorite = function() {
            if(!currentItemId) return;
            let favs = JSON.parse(localStorage.getItem('neonFavorites')) || [];
            const idx = favs.indexOf(currentItemId);
            const favBtn = document.getElementById('btn-fav');
            const favIcon = document.getElementById('icon-fav');

            if(idx > -1) {
                favs.splice(idx, 1);
                favBtn.classList.remove('active');
                favIcon.style.color = "var(--text-secondary)";
            } else {
                favs.push(currentItemId);
                favBtn.classList.add('active');
                favIcon.style.color = "var(--accent-primary)";
            }
            localStorage.setItem('neonFavorites', JSON.stringify(favs));
        };

        window.toggleLike = function() {
            if(!currentItemId) return;
            const key = `liked_${currentItemId}`;
            const alreadyLiked = localStorage.getItem(key);
            const ref = db.ref(`social/${currentItemId}/likes`);
            
            ref.transaction(curr => {
                return alreadyLiked ? (curr || 0) - 1 : (curr || 0) + 1;
            }, (err, committed) => {
                if(committed) {
                    if(alreadyLiked) {
                        localStorage.removeItem(key);
                        document.getElementById('btn-like').classList.remove('active');
                    } else {
                        localStorage.setItem(key, 'true');
                        document.getElementById('btn-like').classList.add('active');
                    }
                }
            });
        };

        window.closeDetails = function() {
            document.getElementById('detailsModal').style.display = 'none';
            if(currentItemId) {
                db.ref(`social/${currentItemId}/likes`).off();
                db.ref(`social/${currentItemId}/comments`).off();
            }
            currentItemId = null;
        };

        // --- COMMENTS ---
        window.openComments = function() {
            if(!currentItemId) return;
            document.getElementById('commentsModalWrapper').style.display = 'flex';
            loadComments(currentItemId);
        };
        window.closeComments = function() { document.getElementById('commentsModalWrapper').style.display = 'none'; }

        function loadComments(itemId) {
            const list = document.getElementById('commentsList');
            list.innerHTML = '<p style="text-align:center; color:gray;">Loading...</p>';

            db.ref(`social/${itemId}/comments`).on('value', snapshot => {
                list.innerHTML = '';
                const data = snapshot.val();
                if(!data) {
                    list.innerHTML = '<p style="text-align:center; color:gray;">No comments yet.</p>';
                    return;
                }
                
                Object.keys(data).forEach(key => {
                    const c = data[key];
                    const div = document.createElement('div');
                    div.className = 'comment-item';
                    div.innerHTML = `
                        <div class="c-user">${c.user}</div>
                        <div class="c-text">${c.text}</div>
                        <div class="c-actions">
                            <button class="c-act-btn" onclick="rateComment('${itemId}', '${key}', 'like')">
                                &#128077; ${c.likes || 0}
                            </button>
                            <button class="c-act-btn" onclick="rateComment('${itemId}', '${key}', 'dislike')">
                                &#128078; ${c.dislikes || 0}
                            </button>
                        </div>
                    `;
                    list.appendChild(div);
                });
                list.scrollTop = list.scrollHeight;
            });
        }

        document.getElementById('commentForm').addEventListener('submit', (e) => {
            e.preventDefault();
            if(!currentUser || !currentUser.name) return alert("Please login first.");

            const text = document.getElementById('commentInput').value;
            if(currentItemId && text) {
                db.ref(`social/${currentItemId}/comments`).push({
                    user: currentUser.name, 
                    text: text,
                    timestamp: Date.now(),
                    likes: 0,
                    dislikes: 0
                });
                document.getElementById('commentInput').value = '';
            }
        });

        window.rateComment = function(itemId, commentId, type) {
            const voteKey = `voted_${commentId}`;
            if(localStorage.getItem(voteKey)) {
                return alert("You have already voted on this comment.");
            }
            const ref = db.ref(`social/${itemId}/comments/${commentId}/${type}s`);
            ref.transaction(val => (val || 0) + 1, (err, committed) => {
                if(committed) localStorage.setItem(voteKey, 'true');
            });
        };

        // --- PLAY & RECENT ---
        window.launchGame = function(id) {
            closeDetails(); 
            let recent = JSON.parse(localStorage.getItem('neonRecent')) || [];
            recent = recent.filter(r => r !== id);
            recent.unshift(id);
            if(recent.length > 10) recent.pop();
            localStorage.setItem('neonRecent', JSON.stringify(recent));
            
            const item = allItems.find(i => i.id === id);
            if(!item) return;

            const iframe = document.getElementById('playFrame');
            const css = `<style>html,body{margin:0;padding:0;height:100vh;width:100vw;overflow:hidden;}</style>`;
            iframe.srcdoc = css + item.code;
            document.getElementById('playModal').style.display = 'block';
        };
        window.closePlay = function() {
            document.getElementById('playModal').style.display = 'none';
            document.getElementById('playFrame').srcdoc = '';
        };

        // --- UPLOAD SYSTEM ---
        document.getElementById('uploadForm').addEventListener('submit', (e) => {
            e.preventDefault();
            if(!currentUser) return alert("Please login to upload.");
            
            const sub = {
                code: document.getElementById('upCode').value,
                title: document.getElementById('upTitle').value,
                description: document.getElementById('upDesc').value, 
                logo: document.getElementById('upLogo').value,
                type: document.getElementById('upType').value,
                userName: currentUser.name,
                userEmail: currentUser.email,
                status: 'pending',
                timestamp: Date.now()
            };
            
            db.ref('pendingSubmissions').push(sub).then(() => {
                alert('Submitted for Review!');
                document.getElementById('uploadForm').reset();
                showSection('home');
            });
        });

        // --- MY UPLOADS ---
        function loadMyUploads() {
            if(!currentUser) return;
            const list = document.getElementById('myUploadsList');
            list.innerHTML = 'Loading...';

            Promise.all([
                db.ref('items').orderByChild('userEmail').equalTo(currentUser.email).once('value'),
                db.ref('pendingSubmissions').orderByChild('userEmail').equalTo(currentUser.email).once('value')
            ]).then(snapshots => {
                const approvedSnap = snapshots[0].val() || {};
                const pendingSnap = snapshots[1].val() || {};
                
                list.innerHTML = '';
                let count = 0;

                Object.keys(approvedSnap).forEach(key => {
                    appendUploadItem(key, approvedSnap[key], 'approved', list);
                    count++;
                });

                Object.keys(pendingSnap).forEach(key => {
                    appendUploadItem(key, pendingSnap[key], 'pending', list);
                    count++;
                });

                if(count === 0) list.innerHTML = '<p style="text-align:center; color:gray;">You haven\'t uploaded anything yet.</p>';
            });
        }

        function appendUploadItem(key, item, status, container) {
            const div = document.createElement('div');
            div.className = 'upload-item-row';
            
            let deleteBtnHTML = '';
            if(status === 'approved') {
                deleteBtnHTML = `<button class="btn btn-danger" onclick="deleteApp('${key}')">&#128465;</button>`;
            } else {
                deleteBtnHTML = `<span style="font-size:0.8rem; color:gray;">Wait</span>`;
            }

            const statusClass = status === 'approved' ? 'st-approved' : 'st-pending';

            div.innerHTML = `
                <div style="display:flex; align-items:center; gap:10px;">
                    <img src="${item.logo}" style="width:40px; height:40px; border-radius:10px; object-fit:cover;">
                    <div>
                        <div style="font-weight:bold; font-size:0.9rem;">${item.title}</div>
                        <div class="status-tag ${statusClass}">${status}</div>
                    </div>
                </div>
                <div>${deleteBtnHTML}</div>
            `;
            container.appendChild(div);
        }

        window.deleteApp = function(id) {
            if(confirm("Are you sure?")) {
                db.ref('items/' + id).remove().then(() => {
                    alert("Deleted!");
                    loadMyUploads();
                }).catch(e => alert(e.message));
            }
        };

        // --- ADMIN PANEL ---
        function loadAdminPanel() {
            if(currentUser && currentUser.email !== ADMIN_EMAIL) {
                showSection('home'); return;
            }
            const list = document.getElementById('adminUserList');
            list.innerHTML = 'Loading users...';

            db.ref('users').once('value', snap => {
                const data = snap.val();
                list.innerHTML = '';
                if(!data) return;

                Object.keys(data).forEach(key => {
                    const user = data[key];
                    const isVer = user.isVerified || false;
                    const btnClass = isVer ? 'v-active' : 'v-inactive';
                    const btnText = isVer ? 'Verified' : 'Unverified';

                    const row = document.createElement('div');
                    row.className = 'admin-user-row';
                    row.innerHTML = `
                        <div>
                            <strong>${user.name}</strong><br>
                            <small>${user.email}</small>
                        </div>
                        <button class="verify-btn ${btnClass}" onclick="toggleVerification('${key}', ${isVer})">
                            ${btnText}
                        </button>
                    `;
                    list.appendChild(row);
                });
            });
        }

        window.toggleVerification = function(userKey, currentStatus) {
            db.ref('users/' + userKey).update({ isVerified: !currentStatus }).then(() => {
                loadAdminPanel(); 
            });
        };

        // --- NOTIFICATIONS & THEME ---
        function listenForNotifications() {
            if(!currentUser) return;
            const emailKey = sanitizeEmail(currentUser.email);
            db.ref('notifications/' + emailKey).on('child_added', (snap) => {
                if(!snap.val().read) {
                    document.getElementById('notifBadge').style.display = 'block';
                    snap.ref.update({ read: true }); 
                }
            });
        }
        window.checkNotifications = function() {
           if(!currentUser) return alert("Please login first.");
           document.getElementById('notifBadge').style.display = 'none';
           alert("No new notifications.");
        };

        window.openThemeModal = function() { document.getElementById('themeModal').style.display = 'flex'; toggleMenu(); }
        window.closeThemeModal = function() { document.getElementById('themeModal').style.display = 'none'; }
        window.setTheme = function(theme) {
            document.documentElement.removeAttribute('data-theme');
            document.documentElement.removeAttribute('data-neon');
            document.querySelectorAll('.theme-btn').forEach(b => b.classList.remove('selected'));
            document.getElementById('neonSubOptions').style.display = 'none';

            if(theme === 'dark') {
                document.getElementById('btnDark').classList.add('selected');
            } else if (theme === 'light') {
                document.documentElement.setAttribute('data-theme', 'light');
                document.getElementById('btnLight').classList.add('selected');
            } else if (theme === 'neon') {
                document.getElementById('btnNeon').classList.add('selected');
                document.getElementById('neonSubOptions').style.display = 'block';
                setNeonColor('blue');
            }
        }
        window.setNeonColor = function(c) {
            document.documentElement.setAttribute('data-neon', c);
            document.querySelectorAll('.swatch').forEach(s => s.classList.remove('active'));
            document.querySelector(`.sw-${c}`).classList.add('active');
        }

    </script>
</body>
</html>